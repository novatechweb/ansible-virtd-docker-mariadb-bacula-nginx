#!/bin/bash
set -e
set -x

USER=$(<$PG_USER_FILE)
USER_PASSWORD=$(<$PG_USER_PASSWORD_FILE)
DBNAME=$(<$PG_USER_DB_FILE)

psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" <<-EOSQL
    CREATE USER $USER WITH PASSWORD '$USER_PASSWORD';
    CREATE DATABASE $DBNAME;
    GRANT ALL PRIVILEGES ON DATABASE $DBNAME TO $USER;
EOSQL
